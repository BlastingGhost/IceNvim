-- ==============================================
-- LSP 核心配置入口文件：批量加载 LSP 相关所有模块
-- 作用：统一管理 LSP（语言服务器协议）的完整工作流，包括服务启动、插件集成、代码补全、格式化等
-- 核心价值：让 Neovim 具备「IDE 级」的代码辅助功能，支持绝大多数编程语言（如 Python/JS/TS/C/C++ 等）
-- 加载逻辑：按「基础服务→插件集成→核心功能→工具扩展」的顺序加载，确保依赖关系正确
-- 新手说明：LSP 是代码补全、语法检查、跳转定义等功能的核心，以下详细解释每个模块的作用、插件组成和使用场景
-- ==============================================

-- 1. LSP 基础服务配置：lsp/lsp.lua
-- 核心定位：LSP 服务的「启动器」和「基础设置中心」
-- 核心功能与特性：
-- - 语言服务器安装与启动：自动检测当前文件类型，启动对应语言服务器（如 Python 对应 pyright，JS/TS 对应 tsserver）
-- - 全局 LSP 配置：统一设置所有语言服务器的通用规则（如代码诊断显示样式、跳转快捷键、悬浮提示格式）
-- - 语言专属配置：为特定语言定制 LSP 行为（如 Python 禁用某些诊断规则、C++ 启用额外代码分析）
-- - 服务管理：自动重启崩溃的 LSP 服务、关闭文件时停止无用服务（节省资源）
-- 关键插件/工具依赖：
-- - nvim-lspconfig：Neovim 官方 LSP 配置库，提供主流语言服务器的默认配置
-- - mason.nvim + mason-lspconfig.nvim：LSP 服务自动安装工具（无需手动下载语言服务器）
-- 使用场景：
-- - 打开代码文件时，自动启动对应 LSP 服务（如打开 .py 文件启动 pyright）
-- - 配置 LSP 诊断信息的显示（如错误用红色波浪线、警告用黄色波浪线）
-- 注意点：
-- - 首次打开某类文件时，会自动下载对应语言服务器（需联网，耐心等待）
-- - 若 LSP 未启动，可执行 :LspStart 手动启动，或 :Mason 检查语言服务器是否已安装
require "lsp.lsp"

-- 2. LSP 插件集成配置：lsp/plugins.lua
-- 核心定位：LSP 功能的「增强插件集合」，扩展基础 LSP 的能力边界
-- 核心功能与特性（集成的关键插件及作用）：
-- - nvim-lspsaga：LSP 功能的「UI 增强器」，让操作更直观（核心功能：悬浮提示美化、代码诊断列表、重命名批量修改、代码操作菜单）
--   - 悬浮提示：鼠标悬停在变量/函数上，显示格式化的文档注释（含参数、返回值、示例）
--   - 诊断列表：:Lspsaga show_line_diagnostics 查看当前行所有问题，点击可跳转修复
--   - 重命名：光标选中变量，执行 :Lspsaga rename 批量修改所有引用（比原生 rename 更智能）
-- - trouble.nvim：诊断信息的「集中管理器」
--   - 功能：将所有代码问题（错误/警告/提示）汇总到一个窗口，支持分类筛选（如只看错误）、点击跳转
--   - 使用：执行 :Trouble 打开诊断窗口，:TroubleClose 关闭
-- - lsp-signature.nvim：函数参数「实时提示器」
--   - 功能：输入函数括号时，实时显示参数列表和当前输入位置（无需悬停，打字时直接看到）
-- - navic.nvim：代码「导航栏」
--   - 功能：在状态栏显示当前光标所在的代码位置（如「文件→类→方法」层级）
--   - 适用场景：大型项目中快速了解当前代码在整个项目结构中的位置
-- 使用场景：
-- - 编写函数时，实时看到参数提示（lsp-signature.nvim）
-- - 项目存在多个语法错误时，用 Trouble 集中查看和修复
-- - 批量重命名变量/函数（Lspsaga rename）
-- 注意点：
-- - 部分插件有专属快捷键（如 Lspsaga 的 K 键触发悬浮提示），可在插件文档中查看
-- - 若插件功能未生效，执行 :LspInfo 检查 LSP 服务是否正常运行
require "lsp.plugins"

-- 3. LSP 代码补全配置：lsp/completion.lua
-- 核心定位：基于 LSP 的「智能代码补全」功能实现
-- 核心功能与特性：
-- - 触发方式：支持「自动触发」（打字时自动弹出补全列表）和「手动触发」（按 <C-space> 弹出）
-- - 补全类型：
--   - 语法补全：变量名、函数名、类名、关键字（如 if/for 等）
--   - 语义补全：根据代码上下文推荐（如调用对象的方法、导入模块的属性）
--   - 片段补全：代码模板快速插入（如输入 for 自动补全 for 循环结构）
-- - 补全优化：补全列表排序（优先显示常用项）、模糊匹配（输入部分字符即可匹配）、补全后自动格式化（如括号自动闭合）
-- 关键插件依赖：
-- - nvim-cmp：Neovim 生态最强大的补全框架，负责补全列表的渲染和交互
-- - cmp-nvim-lsp：将 LSP 提供的补全候选注入到 nvim-cmp 中（核心依赖）
-- - cmp-buffer：从当前缓冲区提取文本作为补全候选（如文件中已出现的变量名）
-- - cmp-path：文件路径补全（如导入模块、读取文件时自动补全路径）
-- - cmp-snippets：代码片段补全（支持 vs-code 风格片段）
-- - luasnip：代码片段引擎，支持自定义代码模板
-- 使用场景：
-- - 编写代码时自动弹出补全列表（如输入「pri」补全「print()」）
-- - 手动触发补全：忘记函数名时，按 <C-space> 查看所有可用选项
-- - 插入代码片段：输入「fori」补全「for i in range()」循环结构
-- 注意点：
-- - 补全快捷键可自定义（默认 <Tab> 选中补全项，<C-n>/<C-p> 上下切换）
-- - 若补全无结果，检查 LSP 服务是否正常运行（:LspInfo），或当前文件类型是否支持补全
require "lsp.completion"

-- 4. 代码格式化配置：lsp/format.lua
-- 核心定位：LSP 驱动的「自动格式化工具」，让代码风格统一
-- 核心功能与特性：
-- - 格式化触发方式：
--   - 自动格式化：保存文件时自动格式化（:w 时触发）
--   - 手动格式化：执行 :Format 命令手动触发
-- - 多工具支持：支持 LSP 内置格式化 + 第三方格式化工具（按需选择）
-- - 语言专属配置：为不同语言设置不同格式化规则（如 Python 用 black，JS/TS 用 prettier）
-- 关键插件/工具依赖：
-- - null-ls.nvim：第三方格式化工具集成框架（连接 Neovim 和外部格式化工具）
-- - 常用格式化工具：
--   - black（Python）：强制遵循 PEP8 规范，自动调整缩进、换行
--   - prettier（JS/TS/HTML/CSS）：前端通用格式化工具，支持多种文件类型
--   - clang-format（C/C++/Java）：C 系语言格式化工具，支持自定义代码风格
--   - stylua（Lua）：Lua 代码格式化工具，适配 Neovim 配置文件
-- 使用场景：
-- - 编写 Python 代码后保存，自动调整缩进为 4 空格、行宽控制在 88 列（black 规则）
-- - 前端项目中，保存 HTML/JS/CSS 文件时，自动格式化代码结构（prettier 规则）
-- 注意点：
-- - 首次使用时，会自动下载对应格式化工具（需联网）
-- - 若想禁用某文件的自动格式化，可在文件头部添加注释（如 # fmt: off 对 black 生效）
-- - 格式化冲突处理：当 LSP 内置格式化与第三方工具冲突时，默认优先使用第三方工具（效果更优）
require "lsp.format"

-- 5. LSP 额外工具扩展：lsp/extra.lua
-- 核心定位：LSP 生态的「辅助工具集」，补充核心功能之外的实用特性
-- 核心功能与特性（集成的关键工具及作用）：
-- - 代码诊断增强：
--   - diagnosticls：补充 LSP 未覆盖的诊断规则（如代码风格检查、拼写错误提示）
-- - 导入管理：
--   - nvim-lsp-ts-utils（TS/JS 专属）：自动导入缺失的模块、删除无用导入、组织导入顺序
--   - pyright（Python 专属）：自动导入缺失的包、提示未使用的导入
-- - 代码操作增强：
--   - lsp-code-actions：额外的代码修复建议（如自动添加缺失的括号、转换变量类型）
-- - 其他辅助工具：
--   - lsp-inlayhints：代码「内嵌提示」（如 TypeScript 显示变量类型、函数返回值类型，不占用额外行）
--   - lsp-navbuddy：代码结构「可视化导航」（用图形化界面显示当前文件的类、方法、变量层级）
-- 使用场景：
-- - TypeScript 代码中，自动删除未使用的 import 语句（:LspOrganizeImports）
-- - 代码中显示内嵌类型提示（如 let x: number = 1 会显示 x 的类型为 number，无需悬停）
-- - 大型文件中，用 lsp-navbuddy 快速跳转到目标方法（:Navbuddy 打开）
-- 注意点：
-- - 部分工具是语言专属的（如 nvim-lsp-ts-utils 仅支持 TS/JS），其他语言不会加载
-- - 内嵌提示（inlayhints）默认可能关闭，可执行 :LspInlayHint enable 手动启用
require "lsp.extra"

-- ==============================================
-- 新手快速上手 LSP 核心功能清单（注释版，方便查阅）
-- ==============================================
-- | 功能需求                | 操作方式                                  | 依赖模块          | 备注                                  |
-- |-------------------------|-------------------------------------------|-------------------|---------------------------------------|
-- | 代码补全                | 打字自动触发 / <C-space> 手动触发          | lsp/completion    | <Tab> 选中补全项，<C-n>/<C-p> 上下切换 |
-- | 语法检查（错误/警告）   | 打开文件自动检测 / :LspDiagnosticsShowAll  | lsp/lsp           | 错误红色波浪线，警告黄色波浪线        |
-- | 跳转定义（变量/函数）   | 光标选中 + gd 快捷键                      | lsp/lsp           | 跳转到变量/函数的定义位置              |
-- | 查看函数文档            | 光标选中 + K 快捷键（美化显示）            | lsp/plugins（saga）| 显示格式化的参数、返回值、示例        |
-- | 批量重命名              | 光标选中变量 + :Lspsaga rename            | lsp/plugins（saga）| 批量修改所有引用该变量/函数的位置      |
-- | 代码格式化              | :w 自动格式化 / :Format 手动格式化         | lsp/format        | 按语言专属规则统一代码风格            |
-- | 查看所有代码问题        | :Trouble                                  | lsp/plugins（trouble）| 集中显示所有错误/警告，支持分类筛选  |
-- | 组织导入（删除无用导入） | :LspOrganizeImports（TS/JS/Python 等）    | lsp/extra         | 自动优化导入语句，删除未使用的导入    |
-- | 代码结构导航            | :Navbuddy                                  | lsp/extra         | 图形化显示文件结构，快速跳转目标节点  |

-- ==============================================
-- 新手常见问题排查（注释版，快速解决问题）
-- ==============================================
-- 1. LSP 未启动：
--    - 执行 :LspInfo 查看状态，若显示「no active lsp」，说明服务未启动
--    - 执行 :Mason 打开插件管理器，检查当前文件类型对应的语言服务器是否已安装（如 Python 对应 pyright）
--    - 未安装则点击 Install 按钮，安装完成后重启 Neovim 或执行 :LspStart 手动启动
-- 2. 无代码补全：
--    - 先通过 :LspInfo 确认 LSP 服务已活跃（有对应语言服务器运行）
--    - 检查补全快捷键是否被其他配置占用（默认 <Tab> 选中补全项）
--    - 手动触发补全：按 <C-space> 测试是否弹出补全列表，若弹出则自动触发可能被禁用
-- 3. 格式化失效：
--    - 执行 :NullLsInfo 查看格式化工具是否已加载（如 Python 需 black 加载成功）
--    - 确认对应格式化工具已安装（:Mason 中搜索工具名，如 black，未安装则安装）
--    - 检查文件是否有禁用格式化的注释（如 # fmt: off 会让 black 跳过格式化）
-- 4. 跳转定义失败：
--    - 确认当前文件类型的 LSP 支持跳转功能（部分简单脚本语言 LSP 功能有限）
--    - 检查光标是否准确选中变量/函数（需选中名称，而非括号/引号）
--    - 执行 :LspRestart 重启 LSP 服务，排除服务异常问题
-- 5. 插件功能未生效（如 Lspsaga 悬浮提示）：
--    - 执行 :LspInfo 确认 LSP 服务正常运行（服务异常会导致插件无数据可处理）
--    - 检查插件是否已安装（:Lazy 中搜索插件名，如 nvim-lspsaga，未安装则执行 :Lazy install）
--    - 查看插件快捷键是否正确（如 Lspsaga 的悬浮提示默认是 K 键，若被修改需按新快捷键）