-- ==============================================
-- 插件与 LSP 总入口配置文件：统一加载插件管理、插件配置、主题和 LSP 核心
-- 作用：作为 Neovim 配置的「启动总开关」，按「插件管理→插件配置→主题→LSP」的顺序加载
-- 核心逻辑：
-- 1. 先初始化插件管理器（Lazy.nvim），确保所有插件能被识别和加载
-- 2. 再加载每个插件的具体配置（如快捷键、功能开关），让插件按预期工作
-- 3. 接着设置主题（colorscheme），统一界面风格（语法高亮、窗口样式等）
-- 4. 最后加载 LSP 全套配置，启用代码补全、语法检查等核心开发功能
-- 新手说明：该文件是配置加载的核心流程，以下详细解释每个模块的作用、插件组成和使用细节
-- ==============================================

-- 1. 插件管理器初始化：plugins/lazy.lua
-- 核心定位：Neovim 插件的「管家」，负责插件的安装、更新、卸载和依赖管理
-- 核心功能与特性（基于 Lazy.nvim，Neovim 生态最流行的插件管理器）：
-- - 插件声明：集中定义所有要安装的插件（名称、仓库地址、依赖、加载条件）
-- - 自动安装：首次启动时，自动下载所有声明的插件（无需手动克隆仓库）
-- - 增量加载：按文件类型/场景加载插件（如仅打开 Python 文件时加载 pyright，提升启动速度）
-- - 依赖管理：自动处理插件间的依赖关系（如插件 A 依赖插件 B，则先加载 B）
-- - 版本控制：支持指定插件版本（如锁定某插件为稳定版，避免更新后功能异常）
-- - 便捷操作：提供命令行接口（:Lazy）管理插件（更新、卸载、查看状态）
-- 关键功能详解：
-- - 插件声明格式：每个插件是一个 table，核心字段包括：
--   - "作者/仓库名"：如 "neovim/nvim-lspconfig"（GitHub 仓库地址）
--   - name：插件名称（可选，默认从仓库名提取）
--   - dependencies：依赖的其他插件（如 "nvim-treesitter" 依赖 "nvim-treesitter-textobjects"）
--   - event：触发插件加载的事件（如 "BufEnter" 表示打开文件时加载，"CmdlineEnter" 表示进入命令行时加载）
--   - ft：指定插件加载的文件类型（如 "python" 表示仅打开 .py 文件时加载）
--   - config：插件的配置函数（直接在声明中定义简单配置，复杂配置单独放在 plugins/config.lua）
-- 使用场景：
-- - 安装新插件：在 lazy.lua 中添加插件声明，执行 :Lazy install 自动下载
-- - 更新插件：执行 :Lazy update 批量更新所有插件，或在 :Lazy 窗口中单独更新某插件
-- - 卸载插件：删除 lazy.lua 中的插件声明，执行 :Lazy clean 自动删除插件文件
-- - 查看插件状态：执行 :Lazy 打开插件管理窗口，查看每个插件的加载状态、版本、依赖
-- 注意点：
-- - 首次启动时，会自动下载 Lazy.nvim 本身和所有声明的插件（需联网，耐心等待）
-- - 插件加载顺序由依赖和 event/ft 决定，无需手动调整
-- - 若插件未加载，可执行 :Lazy load 插件名 手动加载，或检查加载条件是否满足（如 ft 配置是否正确）
require "plugins.lazy"

-- 2. 插件具体配置：plugins/config.lua
-- 核心定位：所有插件的「功能配置中心」，为每个插件设置个性化规则（快捷键、行为、UI 样式）
-- 核心功能：
-- - 覆盖插件默认配置：修改插件的默认行为（如将 Telescope 的默认搜索路径改为当前项目根目录）
-- - 绑定快捷键：为插件功能绑定自定义快捷键（如将 Nvim-Tree 的打开/关闭绑定到 <leader>e）
-- - 启用/禁用插件特性：控制插件的功能开关（如启用 nvim-cmp 的代码片段补全，禁用自动触发补全）
-- - 集成插件间交互：让不同插件协同工作（如让 Telescope 调用 LSP 进行符号搜索）
-- 关键插件配置详解（常用插件及核心配置）：
-- - nvim-tree.lua（文件树）：
--   - 配置：设置文件树宽度、是否显示隐藏文件（.gitignore 中的文件）、图标样式（使用 Ice.symbols 中的图标）
--   - 快捷键：<leader>e 打开/关闭文件树，<CR> 打开选中文件，d 删除文件，a 新建文件
-- - telescope.nvim（模糊搜索）：
--   - 配置：设置默认搜索目录（项目根目录）、搜索结果排序规则、预览窗口大小
--   - 快捷键：<leader>ff 搜索文件，<leader>fg 搜索文本内容，<leader>fb 搜索缓冲区
-- - bufferline.nvim（标签页）：
--   - 配置：设置标签页显示样式（显示文件图标、修改状态、关闭按钮）
--   - 快捷键：<Tab> 切换到下一个标签页，<S-Tab> 切换到上一个标签页，<C-w> 关闭当前标签页
-- - lualine.nvim（状态栏）：
--   - 配置：设置状态栏显示内容（当前模式、文件名、LSP 状态、行号、时间）
--   - 样式：使用 Ice.symbols 中的图标美化状态栏（如 LSP 正常显示 ✓，错误显示 ❌）
-- - nvim-treesitter（语法高亮）：
--   - 配置：启用额外的语法高亮模块（如括号匹配、代码折叠），设置缩进规则（基于语法自动缩进）
--   - 功能：支持绝大多数编程语言的语法高亮（比 Neovim 原生高亮更精准）
-- 使用场景：
-- - 打开文件树：按 <leader>e 快速浏览项目目录结构
-- - 搜索文件：按 <leader>ff 输入文件名，快速打开目标文件
-- - 切换标签页：打开多个文件后，按 <Tab> 快速切换
-- 注意点：
-- - 插件配置的加载顺序与插件加载顺序一致（依赖插件先配置）
-- - 若插件功能未生效，先检查 lazy.lua 中是否已声明该插件，再检查 config.lua 中的配置是否正确
-- - 复杂插件（如 Telescope）的配置可拆分为单独文件（如 plugins/telescope.lua），在 config.lua 中 require 即可
require "plugins.config"

-- 3. 主题配置：plugins/colorscheme.lua
-- 核心定位：Neovim 界面的「美化师」，统一语法高亮、窗口样式、图标颜色等视觉效果
-- 核心功能与特性：
-- - 主题切换：设置默认主题（如 tokyonight、catppuccin、onedark 等流行主题）
-- - 高亮定制：修改主题的默认高亮规则（如将注释颜色改为灰色，关键字颜色改为蓝色）
-- - 图标颜色：为 Ice.symbols 中的图标设置颜色（如错误图标红色、警告图标黄色）
-- - 窗口样式：配置窗口边框、浮动窗口背景色、光标行高亮颜色等
-- 常用主题特性说明（以热门主题为例）：
-- - tokyonight：
--   - 风格：暗黑系主题，颜色柔和不刺眼，适合长时间编码
--   - 特性：支持三种变体（storm/night/day），内置 LSP 诊断高亮（错误/警告/提示颜色区分明显）
-- - catppuccin：
--   - 风格：马卡龙色系，支持多种色调（latte/frappe/macchiato/mocha），视觉效果清新
--   - 特性：对代码语法高亮分类细致（变量、函数、类、关键字颜色区分清晰）
-- - onedark：
--   - 风格：经典暗黑主题，颜色对比度适中，兼容性好（支持所有主流插件）
--   - 特性：对终端颜色支持完善，避免终端与 Neovim 颜色不一致
-- 配置细节：
-- - 主题加载：通过 vim.cmd.colorscheme("主题名") 加载默认主题
-- - 高亮定制：使用 vim.api.nvim_set_hl() 函数修改高亮组（如 vim.api.nvim_set_hl(0, "Comment", { fg = "#888888" })）
-- - 插件适配：确保主题对所有插件的 UI 元素都有适配（如 Telescope 预览窗口、LSP 悬浮提示）
-- 使用场景：
-- - 切换主题：修改 colorscheme.lua 中的默认主题名称，重启 Neovim 即可生效
-- - 调整高亮：若某语法元素颜色不清晰（如注释太淡），在文件中添加自定义高亮规则
-- 注意点：
-- - 主题需先在 lazy.lua 中声明（如 "folke/tokyonight.nvim"），否则会报错
-- - 部分主题支持透明背景，可通过主题配置开启（如 tokyonight 的 transparent = true）
-- - 若图标颜色异常，检查主题是否支持 Nerd Font 图标高亮，或手动为图标设置颜色
require "plugins.colorscheme"

-- 4. LSP 全套配置加载：lsp（对应 lsp/ 目录下的所有文件）
-- 核心定位：Neovim 的「代码开发核心引擎」，提供 IDE 级别的代码辅助功能
-- 加载内容：自动加载 lsp/ 目录下的所有配置（lsp.lua、plugins.lua、completion.lua、format.lua、extra.lua）
-- 核心功能汇总（详细见 lsp 目录下的注释）：
-- - 语言服务器管理：自动安装/启动对应语言的 LSP 服务（如 Python→pyright、JS/TS→tsserver）
-- - 代码补全：智能补全变量、函数、类、关键字（支持自动触发和手动触发）
-- - 语法检查：实时显示代码中的错误/警告/提示（红色波浪线=错误，黄色=警告，蓝色=提示）
-- - 代码导航：跳转定义（gd）、查看引用（gr）、查看文档（K）、代码结构导航（:Navbuddy）
-- - 代码操作：批量重命名（:Lspsaga rename）、自动修复（代码操作菜单）、组织导入（:LspOrganizeImports）
-- - 代码格式化：保存文件时自动格式化（按语言专属规则，如 Python→black、JS→prettier）
-- - 增强工具：函数参数提示（输入时实时显示）、内嵌类型提示（TS/JS 显示变量类型）、诊断集中管理（:Trouble）
-- 使用场景：
-- - 编写代码时：自动补全函数名、实时提示参数、语法错误即时反馈
-- - 调试代码时：通过 :Trouble 查看所有问题，点击跳转修复
-- - 重构代码时：批量重命名变量、自动删除无用导入、格式化代码风格
-- 注意点：
-- - LSP 服务首次启动时会自动下载（需联网），首次打开某类文件可能需要等待
-- - 若 LSP 功能未生效，执行 :LspInfo 检查服务状态，或 :Mason 检查语言服务器是否已安装
-- - 代码补全/格式化的快捷键可在 lsp/completion.lua 和 lsp/format.lua 中自定义
require "lsp"

-- ==============================================
-- 新手快速上手核心功能清单（注释版，方便查阅）
-- ==============================================
-- | 功能分类                | 操作方式                                  | 依赖模块                | 备注                                  |
-- |-------------------------|-------------------------------------------|-------------------------|---------------------------------------|
-- | 插件管理                | :Lazy 打开插件管理窗口                    | plugins/lazy.lua        | 可更新、卸载、查看插件状态            |
-- | 插件安装                | 在 lazy.lua 中添加插件声明 → :Lazy install | plugins/lazy.lua        | 首次启动自动安装所有插件              |
-- | 文件树操作              | <leader>e 打开/关闭                       | plugins/config.lua（nvim-tree） | 支持新建、删除、重命名文件            |
-- | 模糊搜索                | <leader>ff 搜索文件 / <leader>fg 搜索文本  | plugins/config.lua（telescope） | 按 <ESC> 关闭搜索窗口                |
-- | 标签页切换              | <Tab> 下一个 / <S-Tab> 上一个             | plugins/config.lua（bufferline） | <C-w> 关闭当前标签页                  |
-- | 主题切换                | 修改 colorscheme.lua 中的默认主题 → 重启    | plugins/colorscheme.lua | 需先在 lazy.lua 中声明主题插件        |
-- | 代码补全                | 打字自动触发 / <C-space> 手动触发          | lsp（completion）       | <Tab> 选中，<C-n>/<C-p> 上下切换      |
-- | 跳转定义                | 光标选中变量/函数 → gd                    | lsp（lsp.lua）          | 跳转到定义位置，<C-o> 返回上一级      |
-- | 查看函数文档            | 光标选中 → K                               | lsp（plugins.lua）      | 显示格式化的参数、返回值              |
-- | 代码格式化              | :w 自动格式化 / :Format 手动格式化         | lsp（format.lua）       | 按语言专属规则统一风格                |
-- | 查看代码问题            | :Trouble 打开诊断窗口                     | lsp（plugins.lua）      | 支持分类筛选（仅看错误/警告）         |
-- | 批量重命名              | 光标选中变量 → :Lspsaga rename            | lsp（plugins.lua）      | 批量修改所有引用位置                  |

-- ==============================================
-- 新手常见问题排查（注释版，快速解决问题）
-- ==============================================
-- 1. 插件未安装/加载失败：
--    - 执行 :Lazy 查看插件状态，若显示 "not installed"，点击 Install 或执行 :Lazy install
--    - 检查 lazy.lua 中的插件声明是否正确（仓库地址是否拼写错误）
--    - 网络问题导致下载失败：执行 :Lazy clean 清理残留，再重新执行 :Lazy install
-- 2. 插件功能未生效（如文件树打不开）：
--    - 检查 config.lua 中是否有该插件的配置（如 nvim-tree 的快捷键绑定）
--    - 执行 :Lazy load 插件名 手动加载（如 :Lazy load nvim-tree.lua）
--    - 检查插件依赖是否加载成功（如 telescope 依赖 plenary.nvim，需确保 plenary 已安装）
-- 3. 主题显示异常（如颜色错乱、图标乱码）：
--    - 确认主题已在 lazy.lua 中声明并安装
--    - 图标乱码：检查是否安装 Nerd Font 并在终端中设置（参考 :IceCheckIcons 验证）
--    - 颜色错乱：执行 :set background=dark（或 light）切换背景模式，或更换其他主题测试
-- 4. LSP 服务未启动/功能失效：
--    - 执行 :LspInfo 查看当前 LSP 状态，若显示 "no active lsp"，执行 :LspStart 手动启动
--    - 执行 :Mason 检查对应语言服务器是否已安装（如 Python 需 pyright）
--    - 补全无结果：确认 LSP 服务已活跃，且当前文件类型被 LSP 支持（如 .txt 文件无补全）
-- 5. 快捷键无效（如 <leader>e 打不开文件树）：
--    - 检查 config.lua 中是否有该快捷键的绑定（如 vim.keymap.set("n", "<leader>e", "<Cmd>NvimTreeToggle<CR>")）
--    - 确认 <leader> 键是否正确设置（默认是空格，可在 core/keymap.lua 中修改）
--    - 快捷键冲突：其他插件可能占用该快捷键，可修改绑定为其他键（如 <leader>n）
-- 6. 代码格式化失效：
--    - 执行 :NullLsInfo 查看格式化工具是否加载（如 Python 需 black 加载成功）
--    - 检查文件中是否有禁用格式化的注释（如 # fmt: off 会让 black 跳过）
--    - 确认格式化工具已安装（:Mason 中搜索工具名，如 black，未安装则安装）