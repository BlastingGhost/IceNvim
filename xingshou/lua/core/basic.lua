-- ==============================================
-- 核心基础配置文件：Neovim 全局基础功能总开关
-- 作用：统一设置编辑器的显示、编码、缩进、操作逻辑等核心属性
-- 新手友好说明：所有配置均为「开箱即用」，无需修改；
-- 每个选项都附带「作用+原因+注意点+扩展知识」，彻底搞懂背后逻辑
-- ==============================================

-- 定义全局变量快捷键：简化后续代码书写，避免重复输入冗长的 vim.g / vim.opt
-- 核心知识点：
-- - vim.g：用于设置 Neovim 的全局变量（全局生效，所有窗口/文件共享）
-- - vim.opt：用于设置 Neovim 的编辑器选项（控制编辑器行为，支持局部覆盖）
-- 注意点：这只是变量赋值，不会改变任何功能，纯粹为了代码简洁
local g = vim.g
local opt = vim.opt

-- 设置语言环境为 en_US.UTF-8（必须带 UTF-8 后缀，绝对不能只写 en_US）
-- 原作者关键备注：之前仅设置为 en_US 时，复制粘贴命令（yGp，从光标处复制到文件末尾并粘贴）失效
-- 报错信息：E353: Nothing in register ""（寄存器为空，无法粘贴）
-- 深层原因：
-- 1. 缺少 UTF-8 编码支持时，Neovim 无法正确处理寄存器中的字符（尤其是中文、特殊符号）
-- 2. 寄存器是 Neovim 存储复制/剪切内容的临时空间，编码不兼容会导致内容丢失
-- 注意点：
-- - 无论系统是中文还是英文，都建议设为 en_US.UTF-8，避免编码冲突
-- - 若系统没有该语言包，Ubuntu 可通过 sudo apt install language-pack-en-base 安装
vim.cmd "language en_US.UTF-8"

-- 临时关闭语法高亮：syntax off 表示禁用内置语法高亮功能
-- 原作者设计思路：后续会通过插件（如 nvim-treesitter）启用更强大的语法高亮，这里先关闭内置的避免冲突
-- 扩展知识：
-- - 内置语法高亮：Neovim 自带，支持基础语言，但识别精度低、颜色单调
-- - 插件语法高亮（如 nvim-treesitter）：支持更多语言，能识别函数、变量、类型等细分语法，颜色更丰富
-- 注意点：这只是「临时关闭」，不是永久禁用，后续会被插件覆盖
vim.cmd "syntax off"

-- 设置全局编码格式为 UTF-8：控制 Neovim 内部处理字符的编码标准
-- 作用：确保 Neovim 能正确识别和显示中文、日文、特殊符号等非 ASCII 字符
-- 原因：UTF-8 是目前最通用的编码格式，兼容几乎所有字符，避免出现「乱码」
-- 注意点：
-- - 必须与下面的 fileencoding 保持一致，否则保存文件时可能出现编码不匹配
-- - 若打开旧文件出现乱码，可手动设置编码：:set fileencoding=utf-8
g.encoding = "UTF-8"

-- 设置文件编码格式为 utf-8：控制文件保存到硬盘时使用的编码
-- 作用：确保保存后的文件在其他编辑器（如 VS Code、记事本）中打开也不会乱码
-- 扩展知识：
-- - 常见编码格式对比：
--   - GBK：仅支持中文，Windows 记事本默认编码，跨系统打开易乱码
--   - UTF-8：支持所有字符，跨平台通用（推荐）
--   - ASCII：仅支持英文，无法显示中文
-- 注意点：小写的 utf-8 和大写的 UTF-8 效果一致，Neovim 会自动兼容
opt.fileencoding = "utf-8"

-- 获取当前活动窗口的高度：vim.fn.winheight(0) 是 Neovim 内置函数，0 表示「当前窗口」
-- 作用：为后续的滚动偏移配置提供动态值（根据窗口高度自动调整，不是固定值）
-- 扩展知识：vim.fn 是调用 Vimscript 内置函数的接口，类似桥梁，让 Lua 能使用 Vim 的功能
local win_height = vim.fn.winheight(0)

-- 设置垂直滚动偏移（scrolloff）：光标上下保留 (窗口高度-1)/2 行空白
-- 计算逻辑：math.floor 是向下取整，比如窗口高度 10 行时，(10-1)/2=4.5 → 取 4 行
-- 作用：滚动代码时，光标不会贴到屏幕顶部或底部，始终保留一定行数的上下文
-- 举个例子：
-- - 没有设置时：光标移到文件顶部，再向上滚动就会停在第一行，看不到上方内容（本来也没有）
-- - 设置后：光标移到文件顶部时，会自动保留 4 行空白，滚动时能提前看到下方即将出现的代码
-- 原因：避免滚动时「跳来跳去」，提升阅读流畅度，尤其适合长文件
-- 注意点：值越大，保留的空白越多，适合大屏幕；小屏幕可适当减小（如 2-3）
opt.scrolloff = math.floor((win_height - 1) / 2)

-- 设置水平滚动偏移（sidescrolloff）：光标左右保留 (窗口高度-1)/2 列空白
-- 作用：横向滚动代码时，光标不会贴到屏幕左侧或右侧，保留上下文
-- 适用场景：编写超长行代码（如没有自动换行时），横向滚动时能看到光标前后的内容
-- 扩展知识：与 scrolloff 对应，一个控制垂直方向，一个控制水平方向
opt.sidescrolloff = math.floor((win_height - 1) / 2)

-- 启用绝对行号显示：在代码左侧显示 1、2、3... 连续的行号
-- 作用：
-- 1. 快速定位代码位置（比如别人说「第 20 行有问题」，能直接找到）
-- 2. 配合相对行号使用，实现高效移动（如 5j 向下移动 5 行）
-- 注意点：开启后会占用左侧少量空间，若想节省空间可关闭（设为 false）
opt.number = true

-- 启用相对行号显示：光标所在行显示绝对行号，其他行显示与光标的「行数差」
-- 举个例子：
-- - 光标在第 10 行，上方第 8 行显示「2」（10-8=2），下方第 15 行显示「5」（15-10=5）
-- 作用：无需手动计算行数，直接用数字+方向键移动（如 3k 向上移动 3 行，效率极高）
-- 原因：这是 Neovim 高效编辑的核心技巧之一，减少手动计数的麻烦
-- 注意点：
-- - 必须配合绝对行号（number=true）使用，否则单独开启相对行号会混乱
-- - 新手初期可能不适应，用 1-2 天就能习惯，之后会觉得离不开
opt.relativenumber = true

-- 启用光标行高亮：光标所在的整行显示特殊背景色
-- 作用：瞬间定位光标位置，尤其在代码行数多、窗口大的场景下
-- 原因：避免在密密麻麻的代码中「找不到光标」，提升编辑效率
-- 扩展知识：
-- - 可自定义高亮颜色：vim.cmd "highlight CursorLine guibg=#333333"（深色背景）
-- - 若觉得高亮干扰，可关闭（设为 false）或调浅颜色
opt.cursorline = true

-- 始终显示符号列：代码左侧专门用于显示图标的列（如断点、LSP 错误提示、Git 变更标记）
-- 可选值说明：
-- - yes：始终显示，即使没有图标也保留空白列
-- - no：完全隐藏，有图标时也不显示
-- - auto：有图标时显示，无图标时隐藏
-- 作用：避免因图标显示/隐藏导致代码「左右晃动」（比如突然出现一个错误图标，代码整体右移）
-- 原因：保持编辑区域稳定，提升视觉体验
-- 注意点：会占用左侧 1-2 列空间，若不需要图标功能（如不调试、不用 LSP），可设为 auto
opt.signcolumn = "yes"

-- 显示 80 列参考线：在代码第 80 列显示一条竖线
-- 作用：提醒代码行不要超过 80 个字符，符合主流编程规范
-- 原因：
-- 1. 过长的代码行需要横向滚动才能看完，阅读体验差
-- 2. 很多团队的编码规范要求行宽不超过 80 列（如 Python PEP 8 规范）
-- 扩展知识：
-- - 可修改列数：如 opt.colorcolumn = "100"（设置为 100 列）
-- - 可隐藏参考线：opt.colorcolumn = ""（适合不需要行宽限制的场景）
-- 注意点：参考线仅为提醒，不会强制限制代码长度，超过也能正常编辑
opt.colorcolumn = "80"

-- 设置 Tab 键对应的空格数：1 个 Tab 键等于 4 个空格
-- 作用：统一 Tab 键的显示效果，避免不同编辑器对 Tab 的解析不一致
-- 原因：
-- - 有些编辑器默认 1 个 Tab 等于 2 个空格，有些是 4 个，容易导致代码缩进混乱
-- - 4 个空格是主流缩进标准（如 Python、Lua、Go 等语言推荐）
-- 注意点：该选项仅控制「显示效果」，不改变输入行为（后续 expandtab 才会控制 Tab 转空格）
opt.tabstop = 4

-- 设置自动缩进宽度：0 表示继承 tabstop 的值（即 4 个空格）
-- 自动缩进的定义：换行时，Neovim 自动为新行添加的缩进空格数（如 if 语句后换行，自动缩进）
-- 作用：统一换行后的缩进幅度，避免手动缩进的麻烦
-- 原因：
-- - 若设为固定值（如 2），会与 tabstop 不一致，导致缩进混乱
-- - 设为 0 可保持缩进规则统一（自动跟随 tabstop 的设置）
-- 注意点：0 是「继承」而非「禁用」，自动缩进功能依然生效
opt.shiftwidth = 0

-- 启用 Tab 键自动转换为空格：输入 Tab 键时，Neovim 自动替换为对应的空格（4 个）
-- 作用：彻底避免 Tab 字符导致的缩进混乱
-- 原因：
-- - Tab 字符（\t）在不同场景下显示宽度不同（如终端、编辑器、浏览器）
-- - 空格字符（ ）的显示效果在所有场景下都一致，适合团队协作
-- 扩展知识：
-- - 临时禁用转换：按 Ctrl+V 再按 Tab 键（插入原始 Tab 字符）
-- - 若需要保留 Tab 字符（如编写 Makefile），可临时关闭：opt.expandtab = false
-- 注意点：该设置仅影响输入的 Tab 键，文件中已有的 Tab 字符不会自动转换（需手动处理）
opt.expandtab = true

-- 缩进时自动对齐到最近的缩进级别：如 shiftwidth=4 时，缩进总是 4 的倍数
-- 作用：确保缩进的整齐性，避免出现不规则的缩进（如 3 个、5 个空格）
-- 举个例子：
-- - 没有设置时：手动缩进 3 个空格，Neovim 会保留 3 个
-- - 设置后：手动缩进 3 个空格，Neovim 会自动补到 4 个（最近的 4 的倍数）
-- 原因：不规则缩进会导致代码结构混乱，尤其在嵌套代码中（如 if 嵌套、函数嵌套）
opt.shiftround = true

-- 搜索时忽略大小写：输入小写字母也能匹配大写内容（如搜索 "test" 能匹配 "test"、"Test"、"TEST"）
-- 作用：提升搜索效率，无需手动切换大小写
-- 原因：日常搜索中，很少需要严格区分大小写，忽略大小写能减少重复搜索
-- 注意点：该选项会被 smartcase 覆盖（下文会讲），不是绝对的忽略大小写
opt.ignorecase = true

-- 智能大小写匹配：当搜索内容包含大写字母时，自动切换为「区分大小写」
-- 逻辑规则：
-- - 搜索内容全为小写（如 "test"）：忽略大小写（匹配 "test"、"Test" 等）
-- - 搜索内容包含大写（如 "Test"）：区分大小写（仅匹配 "Test"）
-- 作用：兼顾「模糊搜索」和「精确搜索」，无需手动切换配置
-- 原因：
-- - 想要模糊搜索时，直接输入小写即可
-- - 想要精确搜索时，输入包含大写的关键词即可
-- 注意点：必须配合 ignorecase=true 使用，否则该选项无效
opt.smartcase = true

-- 关闭搜索结果高亮：搜索完成后，不高亮显示所有匹配项
-- 作用：减少屏幕上的干扰元素，让注意力集中在编辑上
-- 原作者思路：默认的高亮颜色可能比较刺眼，且搜索完成后高亮意义不大
-- 扩展知识：
-- - 临时开启高亮：搜索后执行 :set hlsearch（或按 * 键再次搜索当前单词）
-- - 临时关闭高亮：按 :nohlsearch（或缩写 :noh）
-- 注意点：关闭后依然能正常搜索，只是不显示高亮，匹配结果会通过光标定位
opt.hlsearch = false

-- 设置命令行高度：1 行（底部输入命令的区域，如 :w 保存、:q 退出）
-- 作用：节省屏幕空间，1 行足够显示大部分命令
-- 原因：默认命令行高度为 1 行，除非需要输入超长命令，否则无需调整
-- 扩展知识：
-- - 增加高度：opt.cmdheight = 2（适合经常输入长命令的场景）
-- - 自动调整：opt.cmdheight = 0（Neovim 0.9+ 支持，命令行自动隐藏，输入时显示）
opt.cmdheight = 1

-- 设置命令历史窗口高度：1 行（按 : 后按上下键查看历史命令的窗口）
-- 作用：查看历史命令时，不会占用过多屏幕空间
-- 原因：日常查看历史命令只需看最近几条，1 行足够，多行会遮挡编辑区域
opt.cmdwinheight = 1

-- 启用文件外部修改自动读取：当文件被其他程序（如 VS Code、记事本）修改时，Neovim 自动刷新内容
-- 作用：避免编辑时使用其他工具修改了文件，Neovim 仍显示旧版本内容
-- 举个例子：
-- - 用 Neovim 打开 test.lua，同时用 VS Code 修改并保存了该文件
-- - 启用该选项后，Neovim 会自动加载 VS Code 修改后的内容
-- - 未启用时，Neovim 会显示旧内容，保存时可能覆盖 VS Code 的修改
-- 注意点：
-- - 若 Neovim 中已修改该文件但未保存，Neovim 会提示「文件已被外部修改，是否加载」
-- - 不会自动覆盖 Neovim 中的未保存修改，避免数据丢失
opt.autoread = true

-- 设置光标在行首/行尾时的换行行为：允许箭头键和方括号键切换行
-- 选项详解：
-- - <：左箭头键，在行首时，切换到上一行的行尾
-- - >：右箭头键，在行尾时，切换到下一行的行首
-- - [：左方括号键，在行首时，切换到上一行的行尾
-- - ]：右方括号键，在行尾时，切换到下一行的行首
-- 作用：光标移动更连贯，无需手动按换行键
-- 举个例子：
-- - 光标在第 1 行的行首，按左箭头键，会自动跳到第 0 行（不存在，所以不跳）
-- - 光标在第 1 行的行尾，按右箭头键，会自动跳到第 2 行的行首
-- 原因：减少光标移动的操作步骤，提升编辑流畅度
-- 扩展知识：可通过 :help 'whichwrap' 查看更多可配置的键位
opt.whichwrap = "<,>,[,]"

-- 允许隐藏已修改的缓冲区：切换文件时，无需强制保存当前修改的文件
-- 核心概念：缓冲区（buffer）是 Neovim 中打开的文件在内存中的副本
-- 作用：同时编辑多个文件时更灵活，不会被强制要求「先保存再切换」
-- 举个例子：
-- - 编辑文件 A 时修改了内容但未保存，想临时查看文件 B
-- - 启用该选项：可直接切换到 B，A 的修改会保存在缓冲区中（不丢失）
-- - 未启用：Neovim 会弹出提示「文件 A 已修改，是否保存？」，必须选择后才能切换
-- 注意点：
-- - 隐藏的修改缓冲区不会自动保存到硬盘，关闭 Neovim 时会提示是否保存
-- - 若想彻底放弃修改，可执行 :bdelete!（强制删除缓冲区）
opt.hidden = true

-- 启用鼠标支持：a 表示「所有模式」都支持鼠标操作
-- 模式说明：
-- - 普通模式（Normal）：移动光标、选择文本
-- - 插入模式（Insert）：编辑文本时调整光标位置
-- - 可视模式（Visual）：拖动选择文本